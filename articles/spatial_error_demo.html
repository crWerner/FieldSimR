<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="FieldSimR">
<title>Simulation of plot errors and phenotypes for a multi-environment plant breeding trial • FieldSimR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Simulation of plot errors and phenotypes for a multi-environment plant breeding trial">
<meta property="og:description" content="FieldSimR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">FieldSimR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/compound_symmetry_GxE_demo.html">Simulation of genetic values using a compound symmetry model for genotype-by-environment (GxE) interaction</a>
    <a class="dropdown-item" href="../articles/spatial_error_demo.html">Simulation of plot errors and phenotypes for a multi-environment plant breeding trial</a>
    <a class="dropdown-item" href="../articles/unstructured_GxE_demo.html">Simulation of genetic values using an unstructured model for genotype-by-environment (GxE) interaction</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/crWerner/fieldsimr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Simulation of plot errors and phenotypes for a multi-environment plant breeding trial</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/crWerner/fieldsimr/blob/HEAD/vignettes/spatial_error_demo.Rmd" class="external-link"><code>vignettes/spatial_error_demo.Rmd</code></a></small>
      <div class="d-none name"><code>spatial_error_demo.Rmd</code></div>
    </div>

    
    
<p><br></p>
<div class="section level3">
<h3 id="background">
<strong>Background</strong><a class="anchor" aria-label="anchor" href="#background"></a>
</h3>
<p>The <strong>R package <a href="https://CRAN.R-project.org/package=fieldSimR" class="external-link">‘FieldSimR’</a></strong>
enables simulation of multi-environment plant breeding trial phenotypes
through the simulation of plot errors and their subsequent combination
with (simulated) genetic values. Its <strong>core function generates
plot errors</strong> comprising 1) a spatially correlated error term, 2)
a random error term, and 3) an extraneous error term. Spatially
correlated errors are simulated using either bivariate interpolation, or
a two-dimensional autoregressive process of order one (AR1:AR1).The
three error terms are combined at a user-deﬁned ratio.</p>
<p><strong>This document demonstrates how to:</strong></p>
<ol style="list-style-type: decimal">
<li>Simulate plot errors for multiple traits tested in multiple
environments,</li>
<li>Simulate phenotypes through the combination of the plot errors with
simulated genetic values, and</li>
<li>Analyse the simulated phenotype data –&gt; <strong><em>change as
desired…</em></strong>
</li>
</ol>
<p><br></p>
<p>The <strong>simulation of plot errors</strong> requires specification
of various simulation parameters that define:</p>
<ol style="list-style-type: decimal">
<li>The field trial layout</li>
<li>The total error variance</li>
<li>The spatial error</li>
<li>Extraneous variation</li>
</ol>
<p><br></p>
<p><strong>Phenotypes</strong> are then simulated through the
combination of the plot errors with the genetic values stored in the
package’s example data frame <code>df_gv_unstr</code>. The data frame
contains simulated genetic values for two traits in three environments
based on an unstructured model for genotype-by-environment (GxE)
interaction. The simulation of the genetic values is shown in
<strong><em>FieldSimR::unstructured_GxE_demo</em></strong>.</p>
<p><br></p>
</div>
<div class="section level3">
<h3 id="simulation-of-plot-errors">
<strong>1. Simulation of plot errors</strong><a class="anchor" aria-label="anchor" href="#simulation-of-plot-errors"></a>
</h3>
<div class="section level4">
<h4 id="field-trial-layout">
<strong>1.1 Field trial layout</strong><a class="anchor" aria-label="anchor" href="#field-trial-layout"></a>
</h4>
<p>We conceive a scenario in which 100 maize hybrids are measured for
grain yield (t/ha) and plant height (cm) in three locations. The first
two locations include three replicates, and the third location includes
two replicates (i.e., we lost one replicate). Each replicate comprises
10 rows and 10 columns. The replicates are arranged in row direction
(“above-and-below”). The plot length (column direction) is 4 meters, and
the plot width (row direction) is 2 meters.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n_envs</span> <span class="op">&lt;-</span> <span class="fl">3</span> <span class="co"># Number of environments.</span></span>
<span><span class="va">n_traits</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="co"># Number of traits.</span></span>
<span><span class="va">n_reps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span> <span class="co"># Number replicates in the three environments, respectively.</span></span>
<span><span class="va">rep_dir</span> <span class="op">&lt;-</span> <span class="st">"row"</span> <span class="co"># Layout of replicates (“above-and-below”).</span></span>
<span><span class="va">n_cols</span> <span class="op">&lt;-</span> <span class="fl">10</span> <span class="co"># Total umber of columns per location.</span></span>
<span><span class="va">n_rows</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">30</span>, <span class="fl">20</span><span class="op">)</span> <span class="co"># Total number of rows per location.</span></span>
<span><span class="va">plot_length</span> <span class="op">&lt;-</span> <span class="fl">5</span> <span class="co"># Plot length; here in meters (column direction).</span></span>
<span><span class="va">plot_width</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="co"># Plot width; here in meters (row direction).</span></span></code></pre></div>
<p><strong>Note:</strong> <code>plot_length</code> and
<code>plot_width</code> are only required when
<code>spatial_model = "Bivariate"</code>. The two arguments are used to
set the x-coordinates and y-coordinates required for the bivariate
interpolation algorithm to model a spatial correlation between plots.
Therefore, the assumed unit of length (meters here) has no actual
meaning, and the ratio between <code>plot_length</code> and
<code>plot_width</code> is important rather than the absolute values. We
recommend to use realistic, absolute values for <code>plot_length</code>
and <code>plot_width</code> regardless of the unit of length.</p>
<p>When spatially correlated errors are simulated based on a
<strong>two-dimensional autoregressive process (AR1:AR1)</strong>,
<code>col_cor</code> and <code>row_cor</code> have to be defined
instead.</p>
<p><br></p>
</div>
<div class="section level4">
<h4 id="total-error">
<strong>1.2 Total error</strong><a class="anchor" aria-label="anchor" href="#total-error"></a>
</h4>
<p>To obtain predefined target heritabilities at the plot-level, we need
to define the total error variances for the two simulated traits
relative to their genetic variances. We assume broad-sense
heritabilities at the plot level of
<strong><em>H<sup>2</sup></em></strong> <strong>= 0.1 for grain
yield</strong> and <strong><em>H<sup>2</sup></em></strong> <strong>= 0.3
for plant height</strong> at all three locations. The heritabilities for
the six trait x environment combinations are stored in a single
vector.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">H2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.3</span>, <span class="fl">0.3</span>, <span class="fl">0.3</span><span class="op">)</span> <span class="co"># c(Yld:E1, Yld:E2, Yld:E3, Pht:E1, Pht:E2, Pht:E3)</span></span></code></pre></div>
<p><br></p>
<p>The total genetic variances of the six trait x environment
combinations (environments nested within traits) can be extracted from
the description of the simulation of the genetic values in
FieldSimR::unstructured_GxE_demo.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.085</span>, <span class="fl">0.12</span>, <span class="fl">0.06</span>, <span class="fl">15.1</span>, <span class="fl">8.5</span>, <span class="fl">11.7</span><span class="op">)</span> <span class="co"># c(Yld:E1, Yld:E2, Yld:E3, Pht:E1, Pht:E2, Pht:E3)</span></span></code></pre></div>
<p><br></p>
<p>We now create a simple function to calculate the total error
variances based on our predefined target heritabilities in vector
<code>H2</code>and the total genetic variances in <code>var</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculation of error variances based on the genetic variance and target heritability vectors.</span></span>
<span><span class="va">calc_var_R</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">var</span>, <span class="va">H2</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">varR</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">var</span> <span class="op">/</span> <span class="va">H2</span><span class="op">)</span> <span class="op">-</span> <span class="va">var</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">varR</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">var_R</span> <span class="op">&lt;-</span> <span class="fu">calc_var_R</span><span class="op">(</span><span class="va">var</span>, <span class="va">H2</span><span class="op">)</span></span>
<span><span class="va">var_R</span> <span class="co"># Vector of error variances: c(Yld:E1, Yld:E2, Yld:E3, Pht:E1, Pht:E2, Pht:E3)</span></span>
<span><span class="co">#&gt; [1]  0.76500  1.08000  0.54000 35.23333 19.83333 27.30000</span></span></code></pre></div>
<p><br></p>
</div>
<div class="section level4">
<h4 id="spatial-error">
<strong>1.3 Spatial error</strong><a class="anchor" aria-label="anchor" href="#spatial-error"></a>
</h4>
<p>We simulate a spatial error term using bivariate interpolation and
assume the proportion of spatial error variance to total error variance
to be 0.4 in all three environments. Additionally, we assume a
correlation between the spatial error of the two traits. However, since
we have no information on the magniture of the correlation, we randomly
sample a value between 0 and 0.5.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spatial_model</span> <span class="op">&lt;-</span> <span class="st">"Bivariate"</span> <span class="co"># Spatial error model.</span></span>
<span><span class="va">prop_spatial</span> <span class="op">&lt;-</span> <span class="fl">0.4</span> <span class="co"># Proportion of spatial to total error variance.</span></span>
<span></span>
<span><span class="va">S_cor_R</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rand_cor_mat.html">rand_cor_mat</a></span><span class="op">(</span><span class="va">n_traits</span>, min_cor <span class="op">=</span> <span class="fl">0</span>, max_cor <span class="op">=</span> <span class="fl">0.5</span>, pos_def <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">S_cor_R</span></span>
<span><span class="co">#&gt;           [,1]      [,2]</span></span>
<span><span class="co">#&gt; [1,] 1.0000000 0.1880721</span></span>
<span><span class="co">#&gt; [2,] 0.1880721 1.0000000</span></span></code></pre></div>
<p><br></p>
</div>
<div class="section level4">
<h4 id="extraneous-variation">
<strong>1.4 Extraneous variation</strong><a class="anchor" aria-label="anchor" href="#extraneous-variation"></a>
</h4>
<p>Extraneous effects can, for example, result from trial management
procedures in row and/or column direction, such as soil tillage, sowing
or harvesting. We want to simulate extraneous variation in row direction
and assume the proportion of extraneous error variance to total error
variance to be 0.2. The correlation between neighbouring rows is assumed
to be highly negative and a value is sampled from a uniform
distribution. We also assume a correlation between the error of the two
traits because of extraneous variation and randomly sample a value
between 0 and 0.5.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prop_ext</span> <span class="op">&lt;-</span> <span class="fl">0.2</span></span>
<span><span class="va">ext_dir</span> <span class="op">&lt;-</span> <span class="st">"row"</span></span>
<span><span class="va">ext_row_cor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, min <span class="op">=</span> <span class="op">-</span><span class="fl">0.9</span>, max <span class="op">=</span> <span class="op">-</span><span class="fl">0.6</span><span class="op">)</span></span>
<span></span>
<span><span class="va">E_cor_R</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rand_cor_mat.html">rand_cor_mat</a></span><span class="op">(</span><span class="va">n_traits</span>, min_cor <span class="op">=</span> <span class="fl">0</span>, max_cor <span class="op">=</span> <span class="fl">0.5</span>, pos_def <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">E_cor_R</span></span>
<span><span class="co">#&gt;           [,1]      [,2]</span></span>
<span><span class="co">#&gt; [1,] 1.0000000 0.2701565</span></span>
<span><span class="co">#&gt; [2,] 0.2701565 1.0000000</span></span></code></pre></div>
<p><strong>Note:</strong> the <strong>proportion of the random error
variance to total error variance</strong> is defined as 1 -
(prop_spatial + prop_ext). Hence, <code>prop_spatial</code> and
<code>prop_ext</code> are set with reference to the random error, and
the sum of the two proportions must not be greater than 1.</p>
<p><br></p>
</div>
<div class="section level4">
<h4 id="simulation-of-plot-errors-1">
<strong>1.5 Simulation of plot errors</strong><a class="anchor" aria-label="anchor" href="#simulation-of-plot-errors-1"></a>
</h4>
<p>Finally, we use all the parameters defined above with the function
<code><a href="../reference/field_trial_error.html">field_trial_error()</a></code> to simulate plot errors for grain yield
and plant height in the three test locations:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">error_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/field_trial_error.html">field_trial_error</a></span><span class="op">(</span></span>
<span>  n_envs <span class="op">=</span> <span class="va">n_envs</span>,</span>
<span>  n_traits <span class="op">=</span> <span class="va">n_traits</span>,</span>
<span>  n_reps <span class="op">=</span> <span class="va">n_reps</span>,</span>
<span>  rep_dir <span class="op">=</span> <span class="va">rep_dir</span>,</span>
<span>  n_cols <span class="op">=</span> <span class="va">n_cols</span>,</span>
<span>  n_rows <span class="op">=</span> <span class="va">n_rows</span>,</span>
<span>  plot_length <span class="op">=</span> <span class="va">plot_length</span>,</span>
<span>  plot_width <span class="op">=</span> <span class="va">plot_width</span>,</span>
<span>  var_R <span class="op">=</span> <span class="va">var_R</span>,</span>
<span>  R_cor_R <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  spatial_model <span class="op">=</span> <span class="va">spatial_model</span>,</span>
<span>  prop_spatial <span class="op">=</span> <span class="va">prop_spatial</span>,</span>
<span>  S_cor_R <span class="op">=</span> <span class="va">S_cor_R</span>,</span>
<span>  prop_ext <span class="op">=</span> <span class="va">prop_ext</span>,</span>
<span>  ext_dir <span class="op">=</span> <span class="va">ext_dir</span>,</span>
<span>  ext_row_cor <span class="op">=</span> <span class="va">ext_row_cor</span>,</span>
<span>  E_cor_R <span class="op">=</span> <span class="va">E_cor_R</span>,</span>
<span>  return_effects <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><strong>Note:</strong> by default, the function
<code><a href="../reference/field_trial_error.html">field_trial_error()</a></code> generates a data frame with the
following columns: <strong><em>environment id</em></strong> (location),
<strong><em>replicate id</em></strong> (block), <strong><em>column
id</em></strong>, <strong><em>row id</em></strong>, and the
<strong><em>total plot error for each trait</em></strong>. When
<code>return_effects = TRUE</code>, <a href="https://CRAN.R-project.org/package=fieldSimR" class="external-link">‘FieldSimR’</a>
returns a list with an additional entry for each trait containing the
spatial error, the extraneous effect and the random error.</p>
<p><br></p>
<p>We will now plot the <strong>total error for grain yield
(“e.Trait.1”) in environment 1</strong>, as well as the <strong>spatial
error component</strong>, the <strong>random error component</strong>,
and the <strong>extraneous variation</strong>. Therefore, we first
extract the required data from <code>error_df</code> and then create an
individual plot for each of the four simulated error terms.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">error_env1</span> <span class="op">&lt;-</span> <span class="va">error_df</span><span class="op">$</span><span class="va">plot_df</span><span class="op">[</span><span class="va">error_df</span><span class="op">$</span><span class="va">plot_df</span><span class="op">$</span><span class="va">env</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span></span>
<span><span class="va">e_comp_env1</span> <span class="op">&lt;-</span> <span class="va">error_df</span><span class="op">$</span><span class="va">Trait.1</span><span class="op">[</span><span class="va">error_df</span><span class="op">$</span><span class="va">Trait.1</span><span class="op">$</span><span class="va">env</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span></span></code></pre></div>
<p><br></p>
<p><strong>Total plot error</strong></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_effects.html">plot_effects</a></span><span class="op">(</span><span class="va">error_env1</span>, effect <span class="op">=</span> <span class="st">"e.Trait.1"</span><span class="op">)</span></span></code></pre></div>
<p><img src="spatial_error_demo_files/figure-html/unnamed-chunk-10-1.png" width="864" style="display: block; margin: auto;"></p>
<p><br></p>
<p><strong>Spatial error</strong> simulated using bivariate
interpolation</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_effects.html">plot_effects</a></span><span class="op">(</span><span class="va">e_comp_env1</span>, effect <span class="op">=</span> <span class="st">"e_spat"</span><span class="op">)</span></span></code></pre></div>
<p><img src="spatial_error_demo_files/figure-html/unnamed-chunk-11-1.png" width="864" style="display: block; margin: auto;"></p>
<p><br></p>
<p><strong>Random error</strong></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_effects.html">plot_effects</a></span><span class="op">(</span><span class="va">e_comp_env1</span>, effect <span class="op">=</span> <span class="st">"e_rand"</span><span class="op">)</span></span></code></pre></div>
<p><img src="spatial_error_demo_files/figure-html/unnamed-chunk-12-1.png" width="864" style="display: block; margin: auto;"></p>
<p><br></p>
<p><strong>Extraneous variation </strong>in the row direction</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_effects.html">plot_effects</a></span><span class="op">(</span><span class="va">e_comp_env1</span>, effect <span class="op">=</span> <span class="st">"e_ext_row"</span><span class="op">)</span></span></code></pre></div>
<p><img src="spatial_error_demo_files/figure-html/unnamed-chunk-13-1.png" width="864" style="display: block; margin: auto;"></p>
<p><br></p>
</div>
</div>
<div class="section level3">
<h3 id="simulation-of-plot-level-phenotypes">
<strong>2. Simulation of plot-level phenotypes</strong><a class="anchor" aria-label="anchor" href="#simulation-of-plot-level-phenotypes"></a>
</h3>
<p>To simulate <strong>grain yield and plant height phenotypes</strong>
for our multi-environment maize experiment, we now combine the simulated
plot errors with the genetic values stored in the example data frame
<code>df_gv_unstr</code>. This is done using the function
<code>pheno_df()</code>, which supports random allocation of genotypes
to plots within blocks, simulating a randomized complete block design
(RCBD).</p>
<p><strong>Note:</strong> more complex field designs require allocation
of genotypes to plots using an external R package or software.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gv_df</span> <span class="op">&lt;-</span> <span class="va">df_gv_unstr</span></span>
<span></span>
<span><span class="va">pheno_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_phenotypes.html">make_phenotypes</a></span><span class="op">(</span></span>
<span>  <span class="va">gv_df</span>,</span>
<span>  <span class="va">error_df</span><span class="op">$</span><span class="va">plot_df</span>,</span>
<span>  randomise <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">pheno_env1</span> <span class="op">&lt;-</span> <span class="va">pheno_df</span><span class="op">[</span><span class="va">pheno_df</span><span class="op">$</span><span class="va">env</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span></span></code></pre></div>
<p><br></p>
<p><strong>Simulated phenotypes</strong></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_effects.html">plot_effects</a></span><span class="op">(</span><span class="va">pheno_env1</span>, effect <span class="op">=</span> <span class="st">"phe.Trait.1"</span><span class="op">)</span></span></code></pre></div>
<p><img src="spatial_error_demo_files/figure-html/unnamed-chunk-15-1.png" width="864" style="display: block; margin: auto;"></p>
<p><br></p>
<p><strong>Histogram showing the genetic phenotypes of the 100 maize
hybrids for grain yield in the three replicates in environment
1</strong></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">pheno_env1</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">phe.Trait.1</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">block</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#e9ecef"</span>, alpha <span class="op">=</span> <span class="fl">0.8</span>, position <span class="op">=</span> <span class="st">"identity"</span>, bins <span class="op">=</span> <span class="fl">50</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"violetred3"</span>, <span class="st">"goldenrod3"</span>, <span class="st">"skyblue2"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Genetic values for grain yield (t/ha)"</span>, y <span class="op">=</span> <span class="st">"Count"</span>, fill <span class="op">=</span> <span class="st">"Block (Replicate)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="spatial_error_demo_files/figure-html/unnamed-chunk-16-1.png" width="864" style="display: block; margin: auto;"></p>
<p><br></p>
</div>
<div class="section level3">
<h3 id="analysis-of-the-simulated-phenotype-data-change-as-desired">
<strong>3. Analysis of the simulated phenotype data</strong> —&gt;
<strong><em>change as desired…</em></strong><a class="anchor" aria-label="anchor" href="#analysis-of-the-simulated-phenotype-data-change-as-desired"></a>
</h3>
<p><br></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Christian Werner, Daniel Tolhurst.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
